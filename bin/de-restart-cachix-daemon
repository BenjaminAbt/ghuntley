#!/usr/bin/env bash
# Copyright (c) 2020 Geoffrey Huntley <ghuntley@ghuntley.com>. All rights reserved.
# SPDX-License-Identifier: Proprietary

set -Eeuo pipefail

LOG="${REPO_ROOT}/logs/cachix-daemon.log"

pidof cachix > /dev/null 2>&1
if [[ $? -ne 0 ]] ; then
    echo "[dev-env] Cachix daemon is running, terminating."
    killall cachix
fi

echo "[dev-env] Starting Cachix in daemon mode and pushing store paths as they are added to /nix/store"

nohup cachix push --compression-level 9 --watch-store ghuntley 1> "${LOG}" 2>&1 &

